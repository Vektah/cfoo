#!/usr/bin/env ruby

lib_path = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift lib_path unless $LOAD_PATH.include? lib_path
require 'cfoo'

if (1..2).include? ARGV.size
    STDERR.puts "Usage: #{File.basename $0} filename"
    exit 1
end

filename = ARGV.shift

file_system = Cfoo::FileSystem.new(".")
project = Cfoo::Project.new(file_system)
parser = Cfoo::Parser.new(file_system)
processor = Cfoo::Processor.new(parser, project)
renderer = Cfoo::Renderer.new
cfoo = Cfoo::Cfoo.new(processor, renderer, STDOUT)

if filename
    cfoo.process filename
else
    cfoo.build_project
end
