#!/usr/bin/env ruby

lib_path = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift lib_path unless $LOAD_PATH.include? lib_path
require 'cfoo'

if ARGV.include? "--help"
    STDERR.puts "Usage: #{File.basename $0} [filename...]"
    exit 1
end

filenames = ARGV

yaml_parser = Cfoo::YamlParser.new
file_system = Cfoo::FileSystem.new(".", yaml_parser)
project = Cfoo::Project.new(file_system)
parser = Cfoo::Parser.new(file_system)
processor = Cfoo::Processor.new(parser, project)
renderer = Cfoo::Renderer.new
cfoo = Cfoo::Cfoo.new(processor, renderer, STDOUT)

if filenames.empty?
    cfoo.build_project
else
    cfoo.process *filenames
end
